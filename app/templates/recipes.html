<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Cyberpunk Recipe Manager</title>

<!-- FAVICONS -->
<link rel="icon" type="image/png" sizes="16x16" href="static/favicon-16.png">
<link rel="icon" type="image/png" sizes="32x32" href="static/favicon-32.png">
<link rel="icon" type="image/png" sizes="48x48" href="static/favicon-48.png">

<!-- FONTS -->
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600&family=Rajdhani:wght@400;600&display=swap" rel="stylesheet">

<style>
* { box-sizing: border-box; }
body {
    margin: 0;
    background-color: #1b1b1e;
    background-image:
        radial-gradient(circle, rgba(255,255,255,0.04) 1px, transparent 1px),
        radial-gradient(circle, rgba(255,255,255,0.03) 1px, transparent 1px);
    background-size: 4px 4px, 2px 2px;
    color: #e2e2e2;
    font-family: 'Rajdhani', sans-serif;
}
.app {
    max-width: 900px;
    margin: 40px auto;
    padding: 20px;
}
h1, h2, h3 {
    font-family: 'Orbitron', sans-serif;
    letter-spacing: 1px;
    text-shadow: 0 0 6px #ff00ff, 0 0 10px #00ffff;
}
h1 { text-align: center; }
input, textarea {
    width: 100%;
    padding: 10px;
    margin: 6px 0 14px;
    background: #1a1a1a;
    color: #00ffff;
    border: 1px solid #ff00ff;
    border-radius: 6px;
    font-size: 16px;
    box-shadow: 0 0 6px #ff00ff;
}
input:focus, textarea:focus {
    outline: none;
    border-color: #00ffff;
    box-shadow: 0 0 12px #00ffff;
}
button {
    padding: 10px;
    border-radius: 6px;
    border: none;
    cursor: pointer;
    font-size: 16px;
    transition: 0.25s;
}
button.primary {
    background: linear-gradient(90deg, #ff00ff, #00ffff);
    color: #111;
    font-weight: bold;
}
button.secondary {
    background: transparent;
    border: 1px solid #00ffff;
    color: #00ffff;
}
button:hover {
    box-shadow: 0 0 14px #00ffff, 0 0 24px #ff00ff;
}
button.danger {
    background: transparent;
    border: 1px solid #ff0055;
    color: #ff0055;
}

button.danger:hover {
    box-shadow: 0 0 14px #ff0055, 0 0 24px #ff00ff;
}
#search { margin-bottom: 25px; }
.collapsible {
    width: 100%;
    background: #121212;
    border: 1px solid #ff00ff;
    color: #00ffff;
    padding: 12px;
    text-align: left;
    font-size: 18px;
    border-radius: 8px;
    box-shadow: 0 0 8px #ff00ff;
}
.collapsible::after { content: "+"; float: right; }
.collapsible.active::after { content: "âˆ’"; }
.content { display: none; margin-top: 15px; padding: 15px; background: #111; border-radius: 10px; border: 2px solid #00ffff; }
.divider { height: 1px; background: linear-gradient(90deg, transparent, #00ffff, #ff00ff, transparent); margin: 40px 0; }
.recipe-box {
    padding: 18px;
    margin-bottom: 20px;
    border-radius: 12px;
    border: 1px solid #00ffff;
    background: #1b1b1e;
    box-shadow: 0 0 10px #00ffff, 0 0 14px #ff00ff;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}
.recipe-box:hover {
    transform: translateY(-4px) scale(1.01);
    box-shadow: 0 0 20px #00ffff, 0 0 30px #ff00ff;
}
.recipe-tags span {
    display: inline-block;
    margin: 4px;
    padding: 6px 10px;
    border-radius: 6px;
    background: #ff00ff;
    color: #111;
    font-weight: bold;
}
/* ---------- MODAL ---------- */
.modal {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(10,10,10,0.95);
    padding: 60px 20px;
    z-index: 100;
}
.modal-content {
    max-width: 600px;
    margin: auto;
    background: #121212;
    padding: 25px;
    border-radius: 12px;
    border: 2px solid #00ffff;
    box-shadow: 0 0 16px #ff00ff, 0 0 20px #00ffff;
    animation: modalIn 0.3s ease;
}
@keyframes modalIn { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
.close { float: right; font-size: 28px; cursor: pointer; color: #ff00ff; }
#quote { text-align: center; margin-top: 40px; font-style: italic; color: #ff00ff; text-shadow: 0 0 6px #00ffff; }
</style>
</head>

<body>
<div class="app">

<h1>Cyberpunk Recipe Manager</h1>

<input id="search" placeholder="Search recipes..." oninput="filterRecipes()">

<div style="text-align:right; margin-bottom:15px;">
    <form method="get" action="/logout" style="display:inline;">
        <button class="secondary" type="submit">Logout</button>
    </form>
</div>

<button id="add-recipe-btn" class="collapsible">Add Recipe</button>

<div id="add-recipe-form" class="content">
    <input id="name" placeholder="Name">
    <input id="description" placeholder="Description">
    <textarea id="ingredients" rows="5" placeholder="Ingredients (one per line)"></textarea>
    <textarea id="instructions" rows="5" placeholder="Instructions"></textarea>
    <button class="primary" onclick="addRecipe()">Add Recipe</button>
</div>

<div class="divider"></div>

<div id="recipes-container"></div>

<!-- MODAL -->
<div id="modal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal()">&times;</span>
        <div id="modal-text"></div>
    </div>
</div>
<div id="edit-modal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeEdit()">&times;</span>

        <h3>Edit Recipe</h3>

        <input id="edit-name">
        <input id="edit-description">
        <textarea id="edit-ingredients" rows="5"></textarea>
        <textarea id="edit-instructions" rows="5"></textarea>

        <button class="primary" onclick="saveEdit()">Save</button>
    </div>
</div>
<script>
// === ADD RECIPE (TYLKO TEN PRZYCISK) ===
const addBtn = document.getElementById("add-recipe-btn");
const addForm = document.getElementById("add-recipe-form");

addBtn.addEventListener("click", () => {
    addBtn.classList.toggle("active");
    addForm.style.display =
        addForm.style.display === "block" ? "none" : "block";
});

const collapsibles = document.querySelectorAll(".recipe_box .collapsible");
collapsibles.forEach(c => {
    c.addEventListener("click", () => {
        c.classList.toggle("active");
        const content = c.nextElementSibling;
        content.style.display = content.style.display === "block" ? "none" : "block";
    });
});

async function loadRecipes() {
    try {
        const res = await fetch("/recipes/");
        const data = await res.json();
        displayRecipes(data);
    } catch (err) {
        console.error("Error loading recipes:", err);
    }
}

function displayRecipes(recipes) {
    const container = document.getElementById("recipes-container");
    container.innerHTML = "";

    recipes.forEach(r => {
        const box = document.createElement("div");
        box.className = "recipe-box";

        box.innerHTML = `
            <h3>${r.name}</h3>
            <p><strong>Description:</strong> ${r.description}</p>
            <p><strong>Ingredients:</strong><br>${r.ingredients.replace(/\n/g, "<br>")}</p>

            <button class="secondary"
                onclick="showInstructions('${r.instructions.replace(/'/g,"\\'")}')">
                View Instructions
            </button>

            <button class="secondary"
                onclick="openEdit(${r.id})">
                Edit
            </button>

            <button class="danger"
                onclick="confirmDelete(${r.id}, '${r.name.replace(/'/g,"\\'")}')">
                Delete
            </button>
        `;

        container.appendChild(box);
    });
}
async function addRecipe() {
    const name = document.getElementById("name").value;
    const description = document.getElementById("description").value;
    const ingredients = document.getElementById("ingredients").value;
    const instructions = document.getElementById("instructions").value;

    const recipe = { name, description, ingredients, instructions };

    try {
        const res = await fetch("/recipes/", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(recipe)
        });
        if (res.ok) {
            loadRecipes();
            document.getElementById("name").value = "";
            document.getElementById("description").value = "";
            document.getElementById("ingredients").value = "";
            document.getElementById("instructions").value = "";
        } else {
            console.error("Failed to add recipe");
        }
    } catch (err) {
        console.error("Error adding recipe:", err);
    }
}

function filterRecipes() {
    const filter = document.getElementById("search").value.toLowerCase();
    document.querySelectorAll(".recipe-box").forEach(box => {
        const text = box.innerText.toLowerCase();
        box.style.display = text.includes(filter) ? "block" : "none";
    });
}

function showInstructions(text) {
    const modal = document.getElementById("modal");
    document.getElementById("modal-text").innerHTML = text.replace(/\n/g, "<br>");
    modal.style.display = "block";
}

function closeModal() {
    document.getElementById("modal").style.display = "none";
}

loadRecipes();
let editingId = null;

function openEdit(id) {
    editingId = id;

    fetch(`/recipes/${id}`)
        .then(res => res.json())
        .then(r => {
            document.getElementById("edit-name").value = r.name;
            document.getElementById("edit-description").value = r.description;
            document.getElementById("edit-ingredients").value = r.ingredients;
            document.getElementById("edit-instructions").value = r.instructions;

            document.getElementById("edit-modal").style.display = "block";
        });
}

function closeEdit() {
    document.getElementById("edit-modal").style.display = "none";
}

async function saveEdit() {
    const recipe = {
        name: document.getElementById("edit-name").value,
        description: document.getElementById("edit-description").value,
        ingredients: document.getElementById("edit-ingredients").value,
        instructions: document.getElementById("edit-instructions").value,
    };

    const res = await fetch(`/recipes/${editingId}`, {
        method: "PUT",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(recipe)
    });

    if (res.ok) {
        closeEdit();
        loadRecipes();
    } else {
        alert("Failed to update recipe");
    }
}
async function confirmDelete(id, name) {
    const ok = confirm(`Delete recipe "${name}"?\nThis cannot be undone.`);
    if (!ok) return;

    try {
        const res = await fetch(`/recipes/${id}`, {
            method: "DELETE"
        });

        if (res.ok) {
            loadRecipes();
        } else {
            alert("Failed to delete recipe");
        }
    } catch (err) {
        console.error("Delete error:", err);
    }
}
</script>

</div> <!-- koniec .app -->
</body>
</html>
